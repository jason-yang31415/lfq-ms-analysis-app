(this["webpackJsonplfq-app"]=this["webpackJsonplfq-app"]||[]).push([[0],{104:function(t,e){},119:function(t,e,n){},120:function(t,e,n){},121:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n(1),i=n.n(r),c=n(19),s=n.n(c),o=(n(54),n(55),n(56),n(8));var u=n(24),l=Object(u.b)(new function(){return new Worker(n.p+"static/js/worker.a2fe456f.worker.js")}),p="SET_INPUT_SAMPLES",d="SET_INPUT_CONDITIONS",O="SET_INPUT_COMPARISONS";function f(t,e){return{type:t,data:e}}var b=Object(o.b)(null,(function(t){return{onDataUpload:function(e){t(function(t){return function(e){new Response(t).arrayBuffer().then((function(t){return l.onDataUpload(Object(u.a)(t,[t]))})).then((function(){return l.getSamples()})).then((function(t){e(f(p,t))}))}}(e))}}}))((function(t){var e=t.onDataUpload;return Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"dataUpload",children:"Upload data: "}),Object(a.jsx)("input",{type:"file",id:"dataUpload",name:"dataUpload",onInput:function(t){return e(t.target.files[0])}})]})})),j=n(4),h=n(2),m=n(18),g=n.n(m);n(70);g.a.setAppElement("#root");var v=Object(o.b)((function(t){return{samples:t.input.samples}}),(function(t){return{onReplicatesSelect:function(e){t(function(t){return function(e){l.onReplicatesSelect(t).then((function(){e(f(d,Object.keys(t)))}))}}(e))}}}))((function(t){var e=t.samples,n=t.onReplicatesSelect,r=i.a.useState(!1),c=Object(h.a)(r,2),s=c[0],o=c[1],u=i.a.useState([]),l=Object(h.a)(u,2),p=l[0],d=l[1],O=i.a.useState(""),f=Object(h.a)(O,2),b=f[0],m=f[1],v=i.a.useState({}),S=Object(h.a)(v,2),N=S[0],x=S[1];return Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{onClick:function(){return o(!0)},children:"Select replicates"}),Object(a.jsxs)(g.a,{isOpen:s,id:"input-replicate-modal",children:[Object(a.jsx)("h1",{id:"input-replicate-modal-head",children:"Select replicates"}),Object(a.jsx)("select",{multiple:!0,onChange:function(t){d(Array.from(t.target.selectedOptions).map((function(t){return t.value})))},children:e.map((function(t){return Object(a.jsx)("option",{value:t,children:t},t)}))}),Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"conditionName",children:"Condition name: "}),Object(a.jsx)("input",{type:"text",id:"conditionName",name:"conditionName",value:b,onChange:function(t){return m(t.target.value)}}),Object(a.jsx)("br",{}),Object(a.jsx)("button",{onClick:function(){0!==b.length&&(x(Object.assign({},N,Object(j.a)({},b,p))),m(""))},children:"Add condition"}),Object(a.jsx)("br",{}),Object(a.jsx)("button",{onClick:function(){return x({})},children:"Reset conditions"})]}),Object(a.jsx)("div",{children:Object.entries(N).map((function(t){var e=Object(h.a)(t,2),n=e[0],r=e[1];return Object(a.jsxs)("p",{children:[n,": ",r.join(", ")]},n)}))}),Object(a.jsx)("div",{id:"input-replicate-modal-foot",children:Object(a.jsx)("button",{onClick:function(){n(N),o(!1)},children:"OK"})})]})]})}));n(71);g.a.setAppElement("#root");var S=Object(o.b)((function(t){return{conditions:t.input.conditions}}),(function(t){return{onComparisonSelect:function(e){var n=Array.from(e.keys()).reduce((function(t,n){return Object.assign(t,Object(j.a)({},n,Array.from(e.get(n))))}),{});t(function(t){return function(e){l.onComparisonsSelect(t),e(f(O,t))}}(n))}}}))((function(t){var e=t.conditions,n=t.onComparisonSelect,r=i.a.useState(!1),c=Object(h.a)(r,2),s=c[0],o=c[1],u=new Map;return Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{onClick:function(){return o(!0)},children:"Select comparisons"}),Object(a.jsxs)(g.a,{isOpen:s,id:"input-comparison-modal",children:[Object(a.jsx)("h1",{id:"input-comparison-modal-head",children:"Select comparisons"}),Object(a.jsx)("table",{children:Object(a.jsxs)("tbody",{children:[Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{}),e.map((function(t){return Object(a.jsx)("td",{children:t},"".concat(t," B"))}))]}),e.map((function(t){return Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{children:t},"".concat(t," A")),e.map((function(e){return Object(a.jsx)("td",{children:Object(a.jsx)("input",{type:"checkbox",onChange:function(n){return function(t,e,n){n?(u.has(t)||u.set(t,new Set),u.get(t).add(e)):u.has(t)&&u.get(t).has(e)&&u.get(t).delete(e)}(t,e,n.target.checked)},disabled:t===e})},"".concat(t,",").concat(e))}))]},"".concat(t," row"))}))]})}),Object(a.jsx)("div",{id:"input-comparison-modal-foot",children:Object(a.jsx)("button",{onClick:function(){n(u),o(!1)},children:"OK"})})]})]})}));var N=function(t){var e=t.id;return Object(a.jsxs)("div",{id:e,className:"input-container",children:[Object(a.jsx)(b,{}),Object(a.jsx)(v,{}),Object(a.jsx)(S,{})]})},x=n(3),y=n(5),T=n.n(y),_=n(10),A=n(42),M=n.n(A),I=n(12),P=n(43),E=n(44),k=(n(75),n(46)),L=n.n(k),w=n(11),C=n.n(w);var R=function(){function t(e,n){Object(P.a)(this,t),this.data=e,this.rawData=e,this.samples=n,this.snapshots=new Map,this.replicates=new Map,this.comparisons=new Map,this.removeContaminants=this.removeContaminants.bind(this),this.logTransform=this.logTransform.bind(this),this.removeAllNaN=this.removeAllNaN.bind(this),this.setReplicates=this.setReplicates.bind(this)}return Object(E.a)(t,[{key:"removeContaminants",value:function(){console.log("removing contaminants"),this.data=this.data.where((function(t){return!t["Potential contaminant"]&&!t.Reverse})).subset([].concat(Object(x.a)(t.COMMON_COLUMNS),Object(x.a)(this.samples.map((function(t){return"LFQ intensity ".concat(t)}))))).bake(),this.snapshots.set(t.SNAPSHOT_KEYS.REMOVE_CONTAMINANTS,this.data)}},{key:"logTransform",value:function(){console.log("log transforming");var e,n=Object(I.a)(this.samples);try{for(n.s();!(e=n.n()).done;){var a=e.value;this.data=this.data.transformSeries(Object(j.a)({},"LFQ intensity ".concat(a),(function(t){return t>0?Math.log2(t):NaN}))).bake()}}catch(r){n.e(r)}finally{n.f()}this.snapshots.set(t.SNAPSHOT_KEYS.LOG_TRANSFORM,this.data)}},{key:"removeAllNaN",value:function(){var t=this;console.log("removing all NaN"),this.data=this.data.where((function(e){return!t.samples.every((function(t){return isNaN(e["LFQ intensity ".concat(t)])}))})).bake()}},{key:"normalizeMedians",value:function(){var e=this;console.log("normalizing medians");var n,a=Math.max.apply(null,this.samples.map((function(t){return e.data.getSeries("LFQ intensity ".concat(t)).where((function(t){return!Number.isNaN(t)})).median()}))),r=Object(I.a)(this.samples);try{var i=function(){var t=n.value,r=e.data.getSeries("LFQ intensity ".concat(t)).where((function(t){return!Number.isNaN(t)})).median();e.data=e.data.transformSeries(Object(j.a)({},"LFQ intensity ".concat(t),(function(t){return t*a/r}))).bake()};for(r.s();!(n=r.n()).done;)i()}catch(c){r.e(c)}finally{r.f()}this.snapshots.set(t.SNAPSHOT_KEYS.MEDIAN_NORMALIZATION,this.data)}},{key:"setReplicates",value:function(t){this.replicates.clear();for(var e=0,n=Object.entries(t);e<n.length;e++){var a=Object(h.a)(n[e],2),r=a[0],i=a[1];this.replicates.set(r,i)}}},{key:"imputeMissingValues",value:function(){var e=this;console.log("imputing missing values");var n,a=Object(I.a)(this.samples);try{var r=function(){var t=n.value,a=e.data.getSeries("LFQ intensity ".concat(t)).where((function(t){return!Number.isNaN(t)})).bake(),r=a.average(),i=a.std();e.data=e.data.transformSeries(Object(j.a)({},"LFQ intensity ".concat(t),(function(t){return Number.isNaN(t)?L.a.uniform(r-3*i,r-2*i)():t}))).bake()};for(a.s();!(n=a.n()).done;)r()}catch(i){a.e(i)}finally{a.f()}this.snapshots.set(t.SNAPSHOT_KEYS.IMPUTE_MISSING_VALUES,this.data)}},{key:"makeComparisons",value:function(e){for(var n,a=this,r=function(t,e){return a.replicates.get(e).map((function(e){return t["LFQ intensity ".concat(e)]}))},i=Array.from(new Set((n=Object.keys(e)).concat.apply(n,Object(x.a)(Object.values(e))))),c=this.data.generateSeries(i.reduce((function(t,e){return Object.assign(t,Object(j.a)({},"mean ".concat(e),(function(t){return C()(r(t,e)).mean()})))}),{})),s=function(){var e=Object(h.a)(u[o],2),n=e[0],i=e[1];a.comparisons.has(n)||a.comparisons.set(n,new Map);var s,l=Object(I.a)(i);try{var p=function(){var e=s.value,i=c.generateSeries({"log FC":function(t){return t["mean ".concat(e)]-t["mean ".concat(n)]},"p value":function(t){return function(t,e){var n=C()(t).mean(),a=C()(e).mean(),r=C()(t).stdev(!0),i=C()(e).stdev(!0),c=Math.sqrt(Math.pow(r,2)/t.length+Math.pow(i,2)/e.length),s=Math.floor(Math.pow(Math.pow(r,2)/t.length+Math.pow(i,2)/e.length,2)/(Math.pow(r,4)/(Math.pow(t.length,2)*(t.length-1))+Math.pow(i,4)/(Math.pow(e.length,2)*(e.length-1)))),o=(a-n)/c;return{t:o,p:2*C.a.studentt.cdf(-Math.abs(o),s),df:s}}(r(t,e),r(t,n)).p}}).subset([].concat(Object(x.a)(t.COMMON_COLUMNS),["mean ".concat(n),"mean ".concat(e),"log FC","p value"])).bake();a.comparisons.get(n).set(e,i)};for(l.s();!(s=l.n()).done;)p()}catch(d){l.e(d)}finally{l.f()}},o=0,u=Object.entries(e);o<u.length;o++)s()}}]),t}();R.SNAPSHOT_KEYS={REMOVE_CONTAMINANTS:"REMOVE_CONTAMINANTS",LOG_TRANSFORM:"LOG_TRANSFORM",MEDIAN_NORMALIZATION:"MEDIAN_NORMALIZATION",IMPUTE_MISSING_VALUES:"IMPUTE_MISSING_VALUES"},R.COMMON_COLUMNS=["id","uniprotID","gene"];var U=R,F={PRE_POST_IMPUTATION_VIOLIN:"PRE_POST_IMPUTATION_VIOLIN",PRE_POST_IMPUTATION_BOXPLOT:"PRE_POST_IMPUTATION_BOXPLOT",VOLCANO:"VOLCANO",P_VALUE_HISTOGRAM:"P_VALUE_HISTOGRAM"};function D(t){return V.apply(this,arguments)}function V(){return(V=Object(_.a)(T.a.mark((function t(e){var n,a;return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.type,a={data:[],layout:{}},t.t0=n,t.next=t.t0===F.PRE_POST_IMPUTATION_VIOLIN?5:t.t0===F.PRE_POST_IMPUTATION_BOXPLOT?9:t.t0===F.VOLCANO?13:t.t0===F.P_VALUE_HISTOGRAM?17:21;break;case 5:return t.next=7,H(e);case 7:return a=t.sent,t.abrupt("break",21);case 9:return t.next=11,K(e);case 11:return a=t.sent,t.abrupt("break",21);case 13:return t.next=15,Y(e);case 15:return a=t.sent,t.abrupt("break",21);case 17:return t.next=19,Z(e);case 19:return a=t.sent,t.abrupt("break",21);case 21:return a.layout.autosize=!0,t.abrupt("return",a);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function H(t){return Q.apply(this,arguments)}function Q(){return(Q=Object(_.a)(T.a.mark((function t(e){var n,a,r,i,c;return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.samples,a=e.conditions,r=function(t){return Object.assign(t,{type:"violin",width:1,points:!1})},i={data:[],layout:{}},void 0==n||void 0!=a){t.next=11;break}return t.next=6,Promise.all([].concat(Object(x.a)(n.map((function(t){return l.getData("LFQ intensity ".concat(t),U.SNAPSHOT_KEYS.MEDIAN_NORMALIZATION).then((function(e){return r({name:"pre",x:e,y0:t,legendgroup:"pre",side:"positive"})}))}))),Object(x.a)(n.map((function(t){return l.getData("LFQ intensity ".concat(t),U.SNAPSHOT_KEYS.IMPUTE_MISSING_VALUES).then((function(e){return r({name:"post",x:e,y0:t,legendgroup:"post",side:"negative"})}))})))));case 6:t.t0=t.sent,t.t1={},i={data:t.t0,layout:t.t1},t.next=20;break;case 11:if(void 0!=n||void 0==a){t.next=20;break}return t.next=14,l.getReplicates();case 14:return c=t.sent,t.next=17,Promise.all([].concat(Object(x.a)(a.map((function(t){return Promise.all(c.get(t).map((function(t){return l.getData("LFQ intensity ".concat(t),U.SNAPSHOT_KEYS.MEDIAN_NORMALIZATION)}))).then((function(t){return t.flat()})).then((function(e){return r({name:"pre",x:e,y0:t,legendgroup:"pre",side:"positive"})}))}))),Object(x.a)(a.map((function(t){return Promise.all(c.get(t).map((function(t){return l.getData("LFQ intensity ".concat(t),U.SNAPSHOT_KEYS.IMPUTE_MISSING_VALUES)}))).then((function(t){return t.flat()})).then((function(e){return r({name:"post",x:e,y0:t,legendgroup:"post",side:"negative"})}))})))));case 17:t.t2=t.sent,t.t3={},i={data:t.t2,layout:t.t3};case 20:return Object.assign(i.layout,{title:"log2 intensities pre- and post-imputation",yaxis:{automargin:!0}}),t.abrupt("return",i);case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(t){return G.apply(this,arguments)}function G(){return(G=Object(_.a)(T.a.mark((function t(e){var n,a,r,i,c;return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.samples,a=e.conditions,r=function(t){return Object.assign(t,{type:"box"})},i={data:[],layout:{}},void 0==n||void 0!=a){t.next=11;break}return t.next=6,Promise.all([].concat(Object(x.a)(n.map((function(t){return l.getData("LFQ intensity ".concat(t),U.SNAPSHOT_KEYS.MEDIAN_NORMALIZATION).then((function(e){return r({name:"pre",y:e,x0:t,legendgroup:"pre"})}))}))),Object(x.a)(n.map((function(t){return l.getData("LFQ intensity ".concat(t),U.SNAPSHOT_KEYS.IMPUTE_MISSING_VALUES).then((function(e){return r({name:"post",y:e,x0:t,legendgroup:"post"})}))})))));case 6:t.t0=t.sent,t.t1={},i={data:t.t0,layout:t.t1},t.next=20;break;case 11:if(void 0!=n||void 0==a){t.next=20;break}return t.next=14,l.getReplicates();case 14:return c=t.sent,t.next=17,Promise.all([].concat(Object(x.a)(a.map((function(t){return Promise.all(c.get(t).map((function(t){return l.getData("LFQ intensity ".concat(t),U.SNAPSHOT_KEYS.MEDIAN_NORMALIZATION)}))).then((function(t){return t.flat()})).then((function(e){return r({name:"pre",y:e,x0:t,legendgroup:"pre"})}))}))),Object(x.a)(a.map((function(t){return Promise.all(c.get(t).map((function(t){return l.getData("LFQ intensity ".concat(t),U.SNAPSHOT_KEYS.IMPUTE_MISSING_VALUES)}))).then((function(t){return t.flat()})).then((function(e){return r({name:"post",y:e,x0:t,legendgroup:"post"})}))})))));case 17:t.t2=t.sent,t.t3={},i={data:t.t2,layout:t.t3};case 20:return Object.assign(i.layout,{title:"log2 intensities pre- and post-imputation",xaxis:{automargin:!0},boxmode:"group",boxgap:-1,boxgroupgap:0}),t.abrupt("return",i);case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Y(t){return B.apply(this,arguments)}function B(){return(B=Object(_.a)(T.a.mark((function t(e){var n;return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.comparisons){t.next=3;break}return t.abrupt("return",{data:[],layout:{}});case 3:return t.next=5,Promise.all([l.getComparisonData(n,"log FC"),l.getComparisonData(n,"p value"),l.getComparisonData(n,"gene")]).then((function(t){var e=Object(h.a)(t,3),n=e[0],a=e[1],r=e[2];return{type:"scattergl",mode:"markers",x:n,y:a.map((function(t){return-1*Math.log10(t)})),hovertext:r}}));case 5:return t.t0=t.sent,t.t1=[t.t0],t.t2={title:"".concat(n[1]," vs. ").concat(n[0])},t.abrupt("return",{data:t.t1,layout:t.t2});case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Z(t){return z.apply(this,arguments)}function z(){return(z=Object(_.a)(T.a.mark((function t(e){var n;return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.comparisons){t.next=3;break}return t.abrupt("return",{data:[],layout:{}});case 3:return t.next=5,l.getComparisonData(n,"p value");case 5:return t.t0=t.sent,t.t1={start:0,end:1,size:.025},t.t2={type:"histogram",x:t.t0,xbins:t.t1},t.t3=[t.t2],t.t4={title:"".concat(n[1]," vs. ").concat(n[0]," p values")},t.abrupt("return",{data:t.t3,layout:t.t4});case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}n(119);var X=Object(o.b)((function(t){return{samples:t.input.samples,conditions:t.input.conditions,comparisons:t.input.comparisons}}),null)((function(t){var e=t.samples,n=t.conditions,r=t.comparisons,c=t.figureType,s=t.onOptionsChange;console.log(r);var o,u=i.a.useState("samples"),l=Object(h.a)(u,2),p=l[0],d=l[1];switch(c){case F.PRE_POST_IMPUTATION_VIOLIN:case F.PRE_POST_IMPUTATION_BOXPLOT:var O=function(t){d(t.currentTarget.value)};o=Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("input",{type:"radio",id:"figureTypeSamples",name:"figureType",value:"samples",checked:"samples"===p,onChange:O}),Object(a.jsx)("label",{htmlFor:"figureTypeSamples",children:"Samples"}),Object(a.jsx)("br",{}),Object(a.jsx)("input",{type:"radio",id:"figureTypeConditions",name:"figureType",value:"conditions",checked:"conditions"===p,onChange:O}),Object(a.jsx)("label",{htmlFor:"figureTypeConditions",children:"Conditions"})]}),Object(a.jsx)("select",{multiple:!0,onChange:function(t){s(Object(j.a)({},p,Array.from(t.target.selectedOptions).map((function(t){return t.value}))))},children:{samples:e,conditions:n}[p].map((function(t){return Object(a.jsx)("option",{value:t,children:t},t)}))})]});break;case F.VOLCANO:case F.P_VALUE_HISTOGRAM:o=Object(a.jsx)("select",{multiple:!0,onChange:function(t){s({comparisons:JSON.parse(t.target.value)})},children:Object.entries(r||{}).map((function(t){var e=Object(h.a)(t,2),n=e[0];return e[1].map((function(t){return Object(a.jsxs)("option",{value:JSON.stringify([n,t]),children:[t," vs. ",n]},JSON.stringify([n,t]))}))})).flat()})}return Object(a.jsx)("div",{className:"figure-sample-condition-selector",children:o})}));n(120);var J=Object(o.b)((function(t){return{samples:t.input.samples}}),null)((function(t){var e=t.id,n=(t.samples,i.a.useState({})),r=Object(h.a)(n,2),c=r[0],s=r[1],o=i.a.useState({data:[],layout:{autosize:!0}}),u=Object(h.a)(o,2),l=u[0],p=u[1],d=function(){var t=Object(_.a)(T.a.mark((function t(){return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=p,t.next=3,D(c);case 3:t.t1=t.sent,(0,t.t0)(t.t1);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(a.jsxs)("div",{id:e,className:"main-container",children:[Object(a.jsxs)("div",{className:"main-figure-options",children:[Object(a.jsx)("select",{onChange:function(t){s(Object.assign({},c,{type:t.target.value})),console.log(t.target.value)},defaultValue:"default",children:[Object(a.jsx)("option",{disabled:!0,value:"default",children:"-- select an option --"},"default")].concat(Object(x.a)(Object.keys(F).map((function(t){return Object(a.jsx)("option",{value:t,children:t},t)}))))}),Object(a.jsx)(X,{figureType:c.type,onOptionsChange:function(t){var e=t.samples,n=t.conditions,a=t.comparisons;return s(Object.assign({},c,{samples:e,conditions:n,comparisons:a}))}}),Object(a.jsx)("button",{onClick:d,children:"Show plot"})]}),Object(a.jsx)(M.a,{className:"main-plot",data:l.data,layout:l.layout,useResizeHandler:!0})]})}));var q=function(t){var e=t.id;return Object(a.jsx)("div",{id:e})};var W=function(){return Object(a.jsxs)("div",{id:"app-container",children:[Object(a.jsx)(N,{id:"input-container"}),Object(a.jsx)(q,{id:"sidepanel-container"}),Object(a.jsx)(J,{id:"mainpanel-container"})]})},$=n(47),tt=n(17),et=n(48),nt={input:{samples:[],conditions:[]},side:{},main:{}};function at(t,e){switch(e.type){case p:return Object.assign({},t,{samples:e.data});case d:return Object.assign({},t,{conditions:e.data});case O:return Object.assign({},t,{comparisons:e.data})}return t}var rt="undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||tt.c,it=Object(tt.d)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt,e=arguments.length>1?arguments[1]:void 0,n=Object($.a)({},t);switch(e.type){case p:case d:case O:n.input=at(t.input,e)}return n}),rt(Object(tt.a)(et.a)));s.a.render(Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(o.a,{store:it,children:Object(a.jsx)(W,{})})}),document.getElementById("root"))},54:function(t,e,n){},55:function(t,e,n){},56:function(t,e,n){},70:function(t,e,n){},71:function(t,e,n){}},[[121,1,2]]]);
//# sourceMappingURL=main.c8db89ea.chunk.js.map